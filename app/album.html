<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />

	<title>柯文哲相簿集</title>

	<link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="lib/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="css/global.css">
</head>
<body>
	<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
	  <div class="container">
	    <div class="navbar-header">
	      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
	        <span class="sr-only">Toggle navigation</span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a href="index.html" class="navbar-brand">柯文哲 API 範例站</a>
	    </div>
	    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
	      <ul class="nav navbar-nav">
	        <li >
	          <a href="index.html">文章範例</a>
	        </li>
	        <li class="active">
	          <a href="album.html">相簿範例</a>
	        </li>
	        <li>
	          <a href="video.html">影片範例</a>
	        </li>
	      </ul>
	      <ul class="nav navbar-nav navbar-right">
	        <li><a href="http://kptaipei.tw" target="_blank">柯文哲官網</a></li>
	        <li>
	          <a href="http://unlimited.kptaipei.tw" target="_blank">野生官網活動介紹</a>
	        </li>
	      </ul>
	    </nav>
	  </div>
	</header>
	<div id="content">
	</div>

	<script src="http://fb.me/react-0.12.1.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.1.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
	<script type="text/jsx">

		
		var Albumbox = React.createClass({

			getInitialState: function(){
				return {
					albums: [],
					selectedPhotos: []
				};
			},

			componentDidMount: function(){
				$.ajax({
      				url: "http://api.kptaipei.tw/v1/albums/?accessToken=YOUR_API_KEY",
      				dataType: 'json',
      				success: function(data) {
      					this.setState({albums: data.data});
    					this.handleAlbumClicked(this.state.albums[0].id);
      				}.bind(this),
      				error: function(xhr, status, err) {
        				console.log("Error fetching albums");
        			}
    			});
			},

			handleAlbumClicked: function(id){
				var albumURL = "http://api.kptaipei.tw/v1/albums/"+id+"?accessToken=YOUR_API_KEY";
				$.ajax({
      				url: albumURL,
      				dataType: 'json',
      				success: function(data) {
      					this.setState({selectedPhotos: data.data.photos});
      				}.bind(this),
      				error: function(xhr, status, err) {
        				console.log("Error fetching albums");
        			}
    			});
			},

			render: function() {
				return (
					<div className="countainer">
					  <Index albums={this.state.albums} onAlbumClicked={this.handleAlbumClicked}/>					  
					  <Photo albums={this.state.selectedAlbum} selectedPhotos={this.state.selectedPhotos}/>
					</div>
				);
			}
		});


		var Index = React.createClass({

			handleClick: function(id){
				this.props.onAlbumClicked(id);
			},

			render: function() {
				var albumNodes = this.props.albums.map(function(album, i){
					var boundClick = this.handleClick.bind(this, album.id);
					return (
						<li className="album" key={i} onClick={boundClick}>{album.title}</li>
					);
				}, this);
				return (
					<div className="col-md-4">
						<h2> 相簿目錄</h2>
						<ul className="categories">
						  {albumNodes}
						</ul>
					</div>
				);
			}
		});

		var Photo = React.createClass({

			render: function() {
				var photoNodes = this.props.selectedPhotos.map(function(photo){
					return (
						<li className="col-md-4 photo"><a target="_blank" href={photo.link}><img className="img-rounded img-responsive" src={photo.images.medium}/></a></li>
					);
				});
				return (
					<div className="photo-container col-xs-12 col-sm-6 col-md-8 col-xs-6 ">
						<ul className="photos row">
							<li>{photoNodes}</li>
						</ul>
					 </div>					
				);
			}
		});

		React.render(<Albumbox />, document.getElementById("content"));
	</script>
</body>
</html>